<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Roadmap Visualiser</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root {
  --bg: #f8f9fb;
  --card: #ffffff;
  --text: #0f0f13;
  --muted: #5a5a67;
  --border: #e7e9f0;
  --accent1: #6C63FF;
  --accent2: #74F0C1;
  --shadow: 0 4px 16px rgba(0,0,0,0.04);
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0b0c10;
    --card: #14151b;
    --text: #f3f4f8;
    --muted: #a3a3b5;
    --border: #24262e;
    --accent1: #8b82ff;
    --accent2: #4de0b5;
    --shadow: 0 4px 20px rgba(0,0,0,0.5);
  }
}

* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  font-family: 'Inter', system-ui, sans-serif;
  color: var(--text);
  background: var(--bg);
  margin: 0;
  padding: 40px clamp(16px, 5vw, 64px);
  background: linear-gradient(180deg, #f8f9fb 0%, #eef0f8 100%);
}

@media (prefers-color-scheme: dark) {
  body {
    background: linear-gradient(180deg, #0b0c10 0%, #161821 100%);
  }
}

h1 {
  font-weight: 700;
  font-size: clamp(28px, 3vw, 38px);
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 12px;
}

#count {
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  color: white;
  border-radius: 999px;
  padding: 2px 10px;
  font-size: 13px;
  margin-left: 10px;
}

.controls {
  margin: 20px 0 28px;
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

label {
  font-size: 13px;
  color: var(--muted);
}

input, select, textarea {
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 10px;
  font-family: inherit;
  background: var(--card);
  color: var(--text);
  outline: none;
  transition: border 0.2s ease, box-shadow 0.2s ease;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--accent1);
  box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
}

.btn {
  border: none;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  color: white;
  font-weight: 600;
  border-radius: 10px;
  padding: 10px 16px;
  cursor: pointer;
  box-shadow: 0 3px 10px rgba(108, 99, 255, 0.2);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
.btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(108, 99, 255, 0.3);
}
.btn:active { transform: translateY(0); }

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}

.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 18px;
  box-shadow: var(--shadow);
  padding: 18px 20px;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}

.pill {
  display: inline-block;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  color: white;
  border-radius: 999px;
  padding: 4px 10px;
  font-size: 12px;
  margin-left: 8px;
}

.meta {
  font-size: 13px;
  color: var(--muted);
  margin-top: 6px;
}

.score {
  font-weight: 700;
  color: var(--accent1);
}

.section {
  margin-top: 40px;
}

h2 {
  font-weight: 600;
  margin-bottom: 12px;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.form {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 20px;
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  box-shadow: var(--shadow);
}

.help {
  font-size: 13px;
  color: var(--muted);
  margin: 8px 0 16px;
}
/* --- top bar --- */
.topbar{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom: 18px; padding: 10px 14px;
  background: var(--card); border:1px solid var(--border); border-radius:14px;
  box-shadow: var(--shadow);
}
.brand{ display:flex; gap:10px; align-items:center; font-weight:700; }
.brand span{ font-size: 16px; letter-spacing: .1px; }

/* ghost button for header toggle */
.btn-ghost{
  background: transparent; color: var(--text);
  border:1px solid var(--border);
  padding:8px 10px; border-radius:10px;
  box-shadow:none;
}
.btn-ghost:hover{ box-shadow: 0 3px 10px rgba(0,0,0,.06); transform: translateY(0); }

/* tiny a11y helper */
.sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

/* --- manual theme overrides (Light/Dark) --- */
/* Default uses your existing variables. These let the toggle force a theme. */
html[data-theme="light"]{
  --bg: #f8f9fb; --card:#ffffff; --text:#0f0f13; --muted:#5a5a67; --border:#e7e9f0;
  --accent1:#6C63FF; --accent2:#74F0C1; --shadow:0 4px 16px rgba(0,0,0,.04);
}
html[data-theme="dark"]{
  --bg:#0b0c10; --card:#14151b; --text:#f3f4f8; --muted:#a3a3b5; --border:#24262e;
  --accent1:#8b82ff; --accent2:#4de0b5; --shadow:0 4px 20px rgba(0,0,0,.5);
  background: linear-gradient(180deg, #0b0c10 0%, #161821 100%);
}

    </style>
  </head>
  <body>
<header class="topbar">
  <div class="brand">
    <!-- Spark logo -->
    <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
      <defs>
        <linearGradient id="g" x1="0" x2="1">
          <stop offset="0" stop-color="var(--accent1)"/>
          <stop offset="1" stop-color="var(--accent2)"/>
        </linearGradient>
      </defs>
      <path fill="url(#g)" d="M12 2l1.9 4.8L19 8l-4.7 2 1.7 5.1L12 12.8 8 15.1 9.7 10 5 8l5.1-1.2L12 2z"/>
    </svg>
    <span>Roadmap Visualiser</span>
  </div>

  <button id="themeToggle" class="btn btn-ghost" type="button" title="Toggle dark / light">
    <span id="themeIcon" aria-hidden="true">üåô</span>
    <span id="themeLabel" class="sr-only">Dark</span>
  </button>
</header>
    <h1>Roadmap Visualiser <span class="count-pill" id="count"></span></h1>

    <div class="controls">
      <label>Quarter:
        <select id="quarterFilter">
          <option value="">All</option>
          <option>2025 Q1</option>
          <option>2025 Q2</option>
          <option>2025 Q3</option>
          <option>2025 Q4</option>
        </select>
      </label>
      <label>Sort by:
        <select id="sortBy">
          <option value="rice">RICE (desc)</option>
          <option value="impact">Impact (desc)</option>
          <option value="effort">Effort (asc)</option>
        </select>
      </label>
      <label>Search:
        <input id="search" placeholder="Search titles‚Ä¶"/>
      </label>
      <div class="toolbar">
        <button id="downloadBtn" class="btn">Download JSON</button>
        <button id="resetLocalBtn" class="btn" title="Clear only your browser‚Äôs saved items">Reset local changes</button>
      </div>
    </div>

    <div class="grid" id="grid"></div>

    <div class="section">
      <h2>Add a project</h2>
      <div class="help">This updates your view immediately and saves to your browser only (localStorage). Use ‚ÄúDownload JSON‚Äù to export and commit later.</div>
      <div class="form" id="addForm">
        <label>Title<br/><input id="f_title" required /></label>
        <label>Quarter<br/>
          <select id="f_quarter">
            <option>2025 Q1</option><option>2025 Q2</option>
            <option>2025 Q3</option><option>2025 Q4</option>
          </select>
        </label>
        <label>Owner<br/><input id="f_owner" placeholder="e.g., Sarah" /></label>
        <label>Team<br/><input id="f_team" placeholder="e.g., Core" /></label>
        <label>Reach<br/><input id="f_reach" type="number" min="0" value="100" /></label>
        <label>Impact<br/>
          <select id="f_impact">
            <option value="3">3 ‚Äî Huge</option>
            <option value="2" selected>2 ‚Äî Medium</option>
            <option value="1">1 ‚Äî Small</option>
            <option value="0.5">0.5 ‚Äî Very minor</option>
            <option value="0.25">0.25 ‚Äî Minimal</option>
          </select>
        </label>
        <label>Confidence<br/>
          <select id="f_confidence">
            <option value="1">1.0 ‚Äî Strong data</option>
            <option value="0.8" selected>0.8 ‚Äî Fairly confident</option>
            <option value="0.6">0.6 ‚Äî Moderate</option>
            <option value="0.4">0.4 ‚Äî Low</option>
          </select>
        </label>
        <label>Effort<br/>
          <select id="f_effort">
            <option value="1">1 ‚Äî ~1 week</option>
            <option value="2" selected>2 ‚Äî ~2‚Äì3 weeks</option>
            <option value="3">3 ‚Äî ~1 month</option>
            <option value="4">4 ‚Äî 1‚Äì2 months</option>
            <option value="5">5 ‚Äî 2+ months</option>
          </select>
        </label>
        <label style="grid-column:1/-1;">Description<br/>
          <textarea id="f_description" placeholder="Short scope / why it matters"></textarea>
        </label>
        <div class="row" style="grid-column:1/-1;">
          <button class="btn" id="addBtn">Add</button>
        </div>
      </div>

      <div class="section">
        <h3>Scoring guide</h3>
        <div class="help">
          <strong>RICE = (Reach √ó Impact √ó Confidence) / Effort</strong><br/>
          Impact: 3 Huge, 2 Medium, 1 Small, 0.5 Very minor, 0.25 Minimal<br/>
          Effort: 1 ‚âà 1 week, 2 ‚âà 2‚Äì3 weeks, 3 ‚âà 1 month, 4 ‚âà 1‚Äì2 months, 5 ‚âà 2+ months<br/>
          Confidence: 1.0 strong data, 0.8 fairly confident, 0.6 moderate, 0.4 low
        </div>
      </div>
    </div>

    <script>
      const state = { items: [], quarter: "", sortBy: "rice", search: "" };
      const LS_KEY = "roadmap_custom_items_v1";

      function riceScore(i){ return Math.round((i.reach * i.impact * i.confidence) / Math.max(1, i.effort)); }

      async function load() {
        const res = await fetch('data.json', {cache:'no-store'});
        const base = await res.json();
        const extra = JSON.parse(localStorage.getItem(LS_KEY) || "[]");
        state.items = [...base, ...extra];
        render();
      }

      function render(){
        const q = state.quarter, s = state.sortBy, term = state.search.toLowerCase();
        let filtered = state.items.filter(i => (!q || i.quarter === q) && i.title.toLowerCase().includes(term));
        filtered.sort((a,b)=>{
          if(s==="impact") return (b.impact - a.impact);
          if(s==="effort") return (a.effort - b.effort);
          return (riceScore(b) - riceScore(a));
        });
        document.getElementById('count').textContent = filtered.length + " items";
        document.getElementById('grid').innerHTML = filtered.map(i=>`
          <div class="card">
            <div><strong>${escapeHtml(i.title)}</strong> <span class="pill">${escapeHtml(i.quarter || '')}</span></div>
            <div class="meta">Owner: ${escapeHtml(i.owner || '‚Äî')} | Team: ${escapeHtml(i.team || '‚Äî')}</div>
            <div class="meta">Reach ${i.reach}, Impact ${i.impact}, Confidence ${i.confidence}, Effort ${i.effort}</div>
            <div class="meta score">RICE: ${riceScore(i)}</div>
            <p>${escapeHtml(i.description || '')}</p>
          </div>
        `).join('');
      }

      function escapeHtml(s){ return String(s || "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

      // filters
      document.getElementById('quarterFilter').addEventListener('change', e => { state.quarter = e.target.value; render(); });
      document.getElementById('sortBy').addEventListener('change', e => { state.sortBy = e.target.value; render(); });
      document.getElementById('search').addEventListener('input', e => { state.search = e.target.value; render(); });

      // add project
      document.getElementById('addBtn').addEventListener('click', () => {
        const item = {
          title: val('f_title'),
          quarter: val('f_quarter'),
          owner: val('f_owner'),
          team: val('f_team'),
          reach: num('f_reach'),
          impact: parseFloat(val('f_impact')),
          confidence: parseFloat(val('f_confidence')),
          effort: parseFloat(val('f_effort')),
          description: val('f_description')
        };
        if(!item.title){ alert('Please enter a title'); return; }
        // append to localStorage list
        const extra = JSON.parse(localStorage.getItem(LS_KEY) || "[]");
        extra.push(item);
        localStorage.setItem(LS_KEY, JSON.stringify(extra));
        state.items.push(item);
        // reset a few fields
        document.getElementById('f_title').value = "";
        document.getElementById('f_description').value = "";
        render();
        window.scrollTo({top:0, behavior:'smooth'});
      });

      // download current dataset
      document.getElementById('downloadBtn').addEventListener('click', () => {
        const extra = JSON.parse(localStorage.getItem(LS_KEY) || "[]");
        // base + extras so you can commit it later if you want to
        const blob = new Blob([JSON.stringify(state.items, null, 2)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'data.json';
        a.click();
        URL.revokeObjectURL(a.href);
      });

      // reset local additions (does not change the repo)
      document.getElementById('resetLocalBtn').addEventListener('click', () => {
        if(confirm('Clear your locally added projects?')) {
          localStorage.removeItem(LS_KEY);
          load();
        }
      });

      function val(id){ return document.getElementById(id).value; }
      function num(id){ return parseFloat(val(id) || '0'); }

      load();
// ---- Theme toggle (persisted in localStorage) ----
const THEME_KEY = "rv_theme";
const rootEl = document.documentElement;
const btnToggle = document.getElementById("themeToggle");
const icon = document.getElementById("themeIcon");
const label = document.getElementById("themeLabel");

function applySavedTheme(){
  const saved = localStorage.getItem(THEME_KEY); // "light" | "dark" | null
  if(saved === "light" || saved === "dark"){
    rootEl.setAttribute("data-theme", saved);
  } else {
    rootEl.removeAttribute("data-theme"); // follow system
  }
  updateToggleVisuals();
}
function toggleTheme(){
  const forced = rootEl.getAttribute("data-theme");
  const next = forced === "dark" ? "light" : "dark";
  rootEl.setAttribute("data-theme", next);
  localStorage.setItem(THEME_KEY, next);
  updateToggleVisuals();
}
function updateToggleVisuals(){
  const isDarkForced = rootEl.getAttribute("data-theme") === "dark";
  const isDarkAuto = !rootEl.getAttribute("data-theme") && window.matchMedia("(prefers-color-scheme: dark)").matches;
  const isDark = isDarkForced || isDarkAuto;
  icon.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
  label.textContent = isDark ? "Light" : "Dark";
}
btnToggle.addEventListener("click", toggleTheme);
applySavedTheme();

    </script>
  </body>
</html>
